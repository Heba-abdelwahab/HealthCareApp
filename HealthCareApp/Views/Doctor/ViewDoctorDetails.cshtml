@model HealthCareApp.ViewModel.Doctor.DoctorDetailsWithReviewsVM
@using System.Security.Claims

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

<h1 class="text-center">
    @Model?.Doctor?.Title @Model?.Doctor?.FirstName @Model?.Doctor?.LastName
</h1>

<div class="card mb-4 shadow-sm">
    <div class="row">
        <div class="col-md-4">
            <img src="@Model?.Doctor?.ProfilePicture" class="img-fluid rounded-start" alt="Profile Picture" />
        </div>
        <div class="col-md-8">
            <div class="card-body">
                <h5 class="card-title">@Model?.Doctor?.Specialization?.Name</h5>
                <p class="card-text"><strong>Description:</strong> @Model?.Doctor?.Description</p>
                <p class="card-text"><strong>Fees:</strong> @Model?.Doctor?.Fees EGP</p>
                <p class="card-text"><strong>Experience:</strong> @Model?.Doctor?.ExperienceYears years</p>
                <p class="card-text"><strong>Waiting Time:</strong> @Model?.Doctor?.WaitingTimeInMinutes min</p>

                <div>
                    <h6>Overall Rating:</h6>
                    @{
                        int rating = (int)(Model?.AverageRating ?? 0);
                    }
                    @for (int i = 1; i <= 5; i++)
                    {
                        if (i <= rating)
                        {
                            <i class="bi bi-star-fill text-warning"></i>
                        }
                        else
                        {
                            <i class="bi bi-star text-muted"></i>
                        }
                    }
                    <p>
                        @(Model?.AverageRating.ToString("0.0") ?? "0.0") / 5.0
                        (from @(Model?.ReviewsCount ?? 0) reviews)
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<h3>Patient Reviews</h3>

@if (Model?.Reviews != null && Model.Reviews.Any())
{
    foreach (var review in Model.Reviews.OrderByDescending(r => r.ReviewDate))
    {
        <div class="card mb-3 shadow-sm">
            <div class="card-body">
                <div>
                    @for (int i = 1; i <= 5; i++)
                    {
                        if (i <= review.Rating)
                        {
                            <i class="bi bi-star-fill text-warning"></i>
                        }
                        else
                        {
                            <i class="bi bi-star text-muted"></i>
                        }
                    }
                </div>
                <p>@review.ReviewText</p>
                <small class="text-muted">
                    By @review.PatientName (@review.Age years old) on @review.ReviewDate.ToShortDateString()
                </small>
            </div>
        </div>
    }
}
else
{
    <p class="text-muted">No reviews available for this doctor yet.</p>
}
